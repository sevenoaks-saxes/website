---
import Layout from '../../layouts/Layout.astro';
import { getCollection, getEntry } from 'astro:content';
import EventCard from '../../components/EventCard.astro';

const entry = await getEntry('pages', 'events');
const events = await getCollection('events');
// Sort events by date (upcoming first)
const sortedEvents = events.sort(
  (a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime()
);
---

<Layout
  title={entry?.data.title || 'Events'}
  description={entry?.data.description}
>
  <section class="bg-downs-chalk pt-32 pb-24 border-b border-knole-ink/5">
    <div class="prose-container">
      <h1 class="text-knole-ink m-0 animate-fade-in-up">
        {entry?.data.title || 'Events'}
      </h1>
      {
        entry?.data.description && (
          <p class="text-2xl text-knole-ink/60 mt-8 max-w-3xl font-medium leading-relaxed animate-fade-in-up stagger-1">
            {entry.data.description}
          </p>
        )
      }
    </div>
  </section>

  <section class="bg-white section-padding">
    <div class="container mx-auto px-6 sm:px-8 lg:px-12">
      {
        sortedEvents.length > 0 ? (
          <div class="grid gap-x-10 gap-y-16 md:grid-cols-2 lg:grid-cols-3">
            {sortedEvents.map((event) => (
              <EventCard event={event} />
            ))}
          </div>
        ) : (
          <div class="text-center py-32 bg-downs-chalk/30 rounded-3xl border-2 border-dashed border-knole-ink/5">
            <p class="text-knole-ink/40 uppercase tracking-[0.3em] font-bold text-sm">
              No upcoming events scheduled at this time.
            </p>
            <p class="mt-4 text-knole-ink/60 font-medium">
              Please check back soon or follow us for updates.
            </p>
          </div>
        )
      }
    </div>
  </section>
</Layout>
