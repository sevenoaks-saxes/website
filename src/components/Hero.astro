---
interface Props {
  title: string;
  description: string;
  primaryCTA: string;
  secondaryCTA: string;
  mesh?: {
    colors?: string[];
    speed?: number;
    grain?: boolean;
    complexity?: number;
    opacity?: number;
  };
}

const { title, description, primaryCTA, secondaryCTA, mesh } = Astro.props;

// Default "Spring" brand colors inspired by the poster
const defaultColors = [
  '#E8B7B7', // Light Heritage Currant (Pinkish)
  '#C5D1C5', // Light Sage Ash
  '#D0E4E8', // Light Mist Blue
  '#F5E6D3', // Soft Peach/Orange
  '#E2D5E8', // Soft Lavender
];

const colors = mesh?.colors && mesh.colors.length > 0 ? mesh.colors : defaultColors;
const speed = mesh?.speed ?? 20;
const complexity = Math.max(2, Math.min(10, mesh?.complexity ?? 8)); // Complexity between 2 and 10
const opacity = mesh?.opacity ?? 1; // Default to full opacity for light theme
const showGrain = mesh?.grain ?? true;
---

<section
  class="relative w-full min-h-[calc(100vh-5rem)] flex items-center justify-center overflow-hidden bg-white"
>
  <!-- Mesh Background Container -->
  <div
    id="mesh-bg"
    class="absolute inset-0 z-0 pointer-events-none overflow-hidden"
    style={`opacity: ${opacity};`}
    data-colors={JSON.stringify(colors)}
    data-speed={speed}
    data-complexity={complexity}
  >
    <!-- Blobs with blur -->
    <div class="absolute inset-0 mesh-container">
      <!-- Blobs injected by client script for randomness -->
    </div>

    {showGrain && <div class="absolute inset-0 grain" />}
  </div>

  <!-- Content Overlay -->
  <div class="relative z-10 container mx-auto px-4 text-center text-graphite">
    <div class="max-w-4xl mx-auto space-y-8">
      <h1
        class="!text-graphite text-5xl md:text-7xl font-serif font-normal leading-[1.1] tracking-tight"
      >
        {title}
      </h1>

      <p
        class="text-xl md:text-2xl font-sans font-medium max-w-2xl mx-auto leading-relaxed opacity-90"
      >
        {description}
      </p>

      <div
        class="flex flex-col sm:flex-row items-center justify-center gap-6 pt-6"
      >
        <a
          href="/events"
          class="min-w-[200px] inline-flex items-center justify-center px-8 py-4 bg-heritage-currant hover:bg-heritage-currant-hover text-white font-sans font-semibold text-lg transition-all duration-300 rounded-md shadow-[0_4px_20px_rgba(0,0,0,0.3)] hover:-translate-y-1 active:translate-y-0"
        >
          {primaryCTA}
        </a>
        <a
          href="/about"
          class="min-w-[200px] inline-flex items-center justify-center px-8 py-4 bg-graphite hover:bg-graphite/90 text-white font-sans font-semibold text-lg transition-all duration-300 rounded-md shadow-[0_4px_20px_rgba(0,0,0,0.3)] hover:-translate-y-1 active:translate-y-0"
        >
          {secondaryCTA}
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  function initMesh() {
    const container = document.getElementById('mesh-bg');
    const blobContainer = container?.querySelector('.mesh-container');
    if (!container || !blobContainer) return;

    const colors = JSON.parse(container.dataset.colors || '[]');
    const speed = parseInt(container.dataset.speed || '20');
    const complexity = parseInt(container.dataset.complexity || '8');

    // Clear any existing blobs (though there shouldn't be any)
    blobContainer.innerHTML = '';

    for (let i = 0; i < complexity; i++) {
      const blob = document.createElement('div');
      blob.className = 'blob absolute rounded-full mix-blend-multiply opacity-70';

      const color = colors[i % colors.length];
      const size = 40 + Math.random() * 40; // Larger blobs: 40% to 80%
      const top = Math.random() * 100 - 20; // Allow it to bleed off edge
      const left = Math.random() * 100 - 20;

      const duration = speed + Math.random() * speed;
      const delay = Math.random() * -speed;

      // Random movement variation
      const tx = Math.random() * 40 - 20;
      const ty = Math.random() * 40 - 20;
      const scale = 0.8 + Math.random() * 0.4;

      blob.style.backgroundColor = color;
      blob.style.width = `${size}%`;
      blob.style.height = `${size}%`;
      blob.style.top = `${top}%`;
      blob.style.left = `${left}%`;
      blob.style.setProperty('--duration', `${duration}s`);
      blob.style.setProperty('--delay', `${delay}s`);
      blob.style.setProperty('--tx', `${tx}%`);
      blob.style.setProperty('--ty', `${ty}%`);
      blob.style.setProperty('--scale', `${scale}`);

      blobContainer.appendChild(blob);
    }
  }

  // Run on initial load
  initMesh();

  // Re-run on view transitions if enabled
  document.addEventListener('astro:after-swap', initMesh);
</script>

<style>
  .mesh-container {
    filter: blur(120px); /* Increased blur for more fluidity */
    /* Forcing a hardware-accelerated layer */
    transform: translate3d(0, 0, 0);
    width: 100%;
    height: 100%;
  }

  .blob {
    animation: blob-movement var(--duration) ease-in-out var(--delay) infinite alternate;
    will-change: transform;
    transform: translate3d(0, 0, 0);
  }

  @keyframes blob-movement {
    0% {
      transform: translate(0, 0) scale(1);
    }
    100% {
      transform: translate(var(--tx), var(--ty)) scale(var(--scale));
    }
  }

  .grain {
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    opacity: 0.1;
    mix-blend-mode: overlay;
    pointer-events: none;
  }

  /* Reduce motion if requested */
  @media (prefers-reduced-motion: reduce) {
    .blob {
      animation: none;
    }
  }
</style>
