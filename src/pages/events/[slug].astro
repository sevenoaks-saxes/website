---
import Layout from '../../layouts/Layout.astro';
import PageHeader from '../../components/PageHeader.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const events = await getCollection('events');
  return events.map((event) => ({
    params: { slug: event.id },
    props: { event },
  }));
}

const { event } = Astro.props;
const { Content } = await render(event);

const formattedDate = new Date(event.data.date).toLocaleDateString('en-GB', {
  weekday: 'long',
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const typeColors = {
  concert:
    'text-orchard-terracotta border-orchard-terracotta/20 bg-orchard-terracotta-light/10',
  rehearsal:
    'text-wealden-green border-wealden-green/20 bg-wealden-green-light/10',
  'play day':
    'text-bluebell-haze border-bluebell-haze/20 bg-bluebell-haze-light/10',
  other: 'text-knole-ink border-knole-ink/20 bg-downs-chalk',
};
---

<Layout title={event.data.name} description={event.data.description}>
  <PageHeader title={event.data.name}>
    <a
      slot="before"
      href="/events"
      class="group inline-flex items-center text-[10px] font-bold text-knole-ink/70 hover:text-wealden-green mb-12 transition-all uppercase tracking-[0.3em]"
    >
      <svg
        class="mr-2 h-4 w-4 transition-transform group-hover:-translate-x-1"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2.5"
          d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      All Events
    </a>

    <div slot="before" class="flex items-center space-x-3 mb-8 animate-fade-in-up">
      <span
        class={`inline-flex items-center px-4 py-1.5 text-[10px] font-bold uppercase tracking-[0.25em] rounded-full border ${typeColors[event.data.type] || typeColors.other}`}
      >
        {event.data.type}
      </span>
    </div>

    <div
      class="grid grid-cols-1 sm:grid-cols-3 gap-10 mt-16 animate-fade-in-up stagger-1"
    >
      <div>
        <h2
          class="text-[10px] font-bold text-wealden-green uppercase tracking-[0.25em] mb-3 mt-0"
        >
          Date
        </h2>
        <p class="text-xl text-knole-ink font-serif">{formattedDate}</p>
      </div>
      <div>
        <h2
          class="text-[10px] font-bold text-wealden-green uppercase tracking-[0.25em] mb-3 mt-0"
        >
          Time
        </h2>
        <p class="text-xl text-knole-ink font-serif">{event.data.time}</p>
      </div>
      <div>
        <h2
          class="text-[10px] font-bold text-wealden-green uppercase tracking-[0.25em] mb-3 mt-0"
        >
          Location
        </h2>
        <p class="text-xl text-knole-ink font-serif leading-relaxed">
          {event.data.location}
        </p>
      </div>
    </div>
  </PageHeader>

  <section class="bg-white py-24 md:py-32">
    <div class="prose-container">
      <div
        class="prose max-w-none prose-p:leading-relaxed prose-headings:font-serif prose-headings:font-normal prose-headings:text-knole-ink prose-img:rounded-3xl prose-img:shadow-2xl"
      >
        <Content />
      </div>
    </div>
  </section>
</Layout>
